import{a as x,e as N,c as y,q as xe,r as se,b as Ce,f as Te,g as Me,h as Pe,k as ye,i as ke}from"./@babel/runtime.77033aed.js";import{r}from"./react.bcb0ff15.js";import{R as be}from"./react-dom.040937d5.js";import{h as Se,e as D,g as re,D as we,j as q,z as De,k as I,s as Ne,f as Ee,F as Ae}from"./rc-util.9e22709c.js";import{c as F}from"./classnames.fcae7549.js";import{C as Q}from"./rc-motion.4d67ed75.js";import{R as Oe}from"./rc-align.8ac14694.js";function Re(n,p,l){return l?n[0]===p[0]:n[0]===p[0]&&n[1]===p[1]}function He(n,p,l){var c=n[p]||{};return x(x({},c),l)}function Ve(n,p,l,c){for(var f=l.points,s=Object.keys(n),e=0;e<s.length;e+=1){var i=s[e];if(Re(n[i].points,f,c))return"".concat(p,"-placement-").concat(i)}return""}function le(n){var p=n.prefixCls,l=n.motion,c=n.animation,f=n.transitionName;return l||(c?{motionName:"".concat(p,"-").concat(c)}:f?{motionName:f}:null)}function _e(n){var p=n.prefixCls,l=n.visible,c=n.zIndex,f=n.mask,s=n.maskMotion,e=n.maskAnimation,i=n.maskTransitionName;if(!f)return null;var t={};return(s||i||e)&&(t=x({motionAppear:!0},le({motion:s,prefixCls:p,transitionName:i,animation:e}))),r.exports.createElement(Q,N({},t,{visible:l,removeOnLeave:!0}),function(o){var a=o.className;return r.exports.createElement("div",{style:{zIndex:c},className:F("".concat(p,"-mask"),a)})})}var ae=["measure","alignPre","align",null,"motion"];const Le=function(n,p){var l=Se(null),c=y(l,2),f=c[0],s=c[1],e=r.exports.useRef();function i(a){s(a,!0)}function t(){D.cancel(e.current)}function o(a){t(),e.current=D(function(){i(function(d){switch(f){case"align":return"motion";case"motion":return"stable"}return d}),a==null||a()})}return r.exports.useEffect(function(){i("measure")},[n]),r.exports.useEffect(function(){switch(f){case"measure":p();break}f&&(e.current=D(xe(se().mark(function a(){var d,h;return se().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:d=ae.indexOf(f),h=ae[d+1],h&&d!==-1&&i(h);case 3:case"end":return u.stop()}},a)}))))},[f]),r.exports.useEffect(function(){return function(){t()}},[]),[f,o]},Ie=function(n){var p=r.exports.useState({width:0,height:0}),l=y(p,2),c=l[0],f=l[1];function s(i){f({width:i.offsetWidth,height:i.offsetHeight})}var e=r.exports.useMemo(function(){var i={};if(n){var t=c.width,o=c.height;n.indexOf("height")!==-1&&o?i.height=o:n.indexOf("minHeight")!==-1&&o&&(i.minHeight=o),n.indexOf("width")!==-1&&t?i.width=t:n.indexOf("minWidth")!==-1&&t&&(i.minWidth=t)}return i},[n,c]);return[e,s]};var pe=r.exports.forwardRef(function(n,p){var l=n.visible,c=n.prefixCls,f=n.className,s=n.style,e=n.children,i=n.zIndex,t=n.stretch,o=n.destroyPopupOnHide,a=n.forceRender,d=n.align,h=n.point,m=n.getRootDomNode,u=n.getClassNameFromAlign,g=n.onAlign,C=n.onMouseEnter,k=n.onMouseLeave,M=n.onMouseDown,E=n.onTouchStart,A=n.onClick,V=r.exports.useRef(),S=r.exports.useRef(),$=r.exports.useState(),_=y($,2),L=_[0],z=_[1],B=Ie(t),O=y(B,2),U=O[0],W=O[1];function j(){t&&W(m())}var b=Le(l,j),J=y(b,2),T=J[0],X=J[1],de=r.exports.useState(0),K=y(de,2),Z=K[0],ee=K[1],Y=r.exports.useRef();re(function(){T==="alignPre"&&ee(0)},[T]);function me(){return h||m}function te(){var v;(v=V.current)===null||v===void 0||v.forceAlign()}function he(v,P){var w=u(P);L!==w&&z(w),ee(function(H){return H+1}),T==="align"&&(g==null||g(v,P))}re(function(){T==="align"&&(Z<2?te():X(function(){var v;(v=Y.current)===null||v===void 0||v.call(Y)}))},[Z]);var R=x({},le(n));["onAppearEnd","onEnterEnd","onLeaveEnd"].forEach(function(v){var P=R[v];R[v]=function(w,H){return X(),P==null?void 0:P(w,H)}});function oe(){return new Promise(function(v){Y.current=v})}r.exports.useEffect(function(){!R.motionName&&T==="motion"&&X()},[R.motionName,T]),r.exports.useImperativeHandle(p,function(){return{forceAlign:te,getElement:function(){return S.current}}});var ve=x(x({},U),{},{zIndex:i,opacity:T==="motion"||T==="stable"||!l?void 0:0,pointerEvents:!l&&T!=="stable"?"none":void 0},s),ie=!0;(d==null?void 0:d.points)&&(T==="align"||T==="stable")&&(ie=!1);var ne=e;return r.exports.Children.count(e)>1&&(ne=r.exports.createElement("div",{className:"".concat(c,"-content")},e)),r.exports.createElement(Q,N({visible:l,ref:S,leavedClassName:"".concat(c,"-hidden")},R,{onAppearPrepare:oe,onEnterPrepare:oe,removeOnLeave:o,forceRender:a}),function(v,P){var w=v.className,H=v.style,ge=F(c,f,L,w);return r.exports.createElement(Oe,{target:me(),key:"popup",ref:V,monitorWindowResize:!0,disabled:ie,align:d,onAlign:he},r.exports.createElement("div",{ref:P,className:ge,onMouseEnter:C,onMouseLeave:k,onMouseDownCapture:M,onTouchStartCapture:E,onClick:A,style:x(x({},H),ve)},ne))})});pe.displayName="PopupInner";var ce=r.exports.forwardRef(function(n,p){var l=n.prefixCls,c=n.visible,f=n.zIndex,s=n.children,e=n.mobile;e=e===void 0?{}:e;var i=e.popupClassName,t=e.popupStyle,o=e.popupMotion,a=o===void 0?{}:o,d=e.popupRender,h=n.onClick,m=r.exports.useRef();r.exports.useImperativeHandle(p,function(){return{forceAlign:function(){},getElement:function(){return m.current}}});var u=x({zIndex:f},t),g=s;return r.exports.Children.count(s)>1&&(g=r.exports.createElement("div",{className:"".concat(l,"-content")},s)),d&&(g=d(g)),r.exports.createElement(Q,N({visible:c,ref:m,removeOnLeave:!0},a),function(C,k){var M=C.className,E=C.style,A=F(l,i,M);return r.exports.createElement("div",{ref:k,className:A,onClick:h,style:x(x({},E),u)},g)})});ce.displayName="MobilePopupInner";var Fe=["visible","mobile"],fe=r.exports.forwardRef(function(n,p){var l=n.visible,c=n.mobile,f=Ce(n,Fe),s=r.exports.useState(l),e=y(s,2),i=e[0],t=e[1],o=r.exports.useState(!1),a=y(o,2),d=a[0],h=a[1],m=x(x({},f),{},{visible:i});r.exports.useEffect(function(){t(l),l&&c&&h(we())},[l,c]);var u=d?r.exports.createElement(ce,N({},m,{mobile:c,ref:p})):r.exports.createElement(pe,N({},m,{ref:p}));return r.exports.createElement("div",null,r.exports.createElement(_e,m),u)});fe.displayName="Popup";var ue=r.exports.createContext(null);function G(){}function $e(){return""}function ze(n){return n?n.ownerDocument:window.document}var Be=["onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur","onContextMenu"];function Ue(n){var p=function(l){Te(f,l);var c=Me(f);function f(s){var e;Pe(this,f),e=c.call(this,s),e.popupRef=r.exports.createRef(),e.triggerRef=r.exports.createRef(),e.portalContainer=void 0,e.attachId=void 0,e.clickOutsideHandler=void 0,e.touchOutsideHandler=void 0,e.contextMenuOutsideHandler1=void 0,e.contextMenuOutsideHandler2=void 0,e.mouseDownTimeout=void 0,e.focusTime=void 0,e.preClickTime=void 0,e.preTouchTime=void 0,e.delayTimer=void 0,e.hasPopupMouseDown=void 0,e.onMouseEnter=function(t){var o=e.props.mouseEnterDelay;e.fireEvents("onMouseEnter",t),e.delaySetPopupVisible(!0,o,o?null:t)},e.onMouseMove=function(t){e.fireEvents("onMouseMove",t),e.setPoint(t)},e.onMouseLeave=function(t){e.fireEvents("onMouseLeave",t),e.delaySetPopupVisible(!1,e.props.mouseLeaveDelay)},e.onPopupMouseEnter=function(){e.clearDelayTimer()},e.onPopupMouseLeave=function(t){var o;t.relatedTarget&&!t.relatedTarget.setTimeout&&q((o=e.popupRef.current)===null||o===void 0?void 0:o.getElement(),t.relatedTarget)||e.delaySetPopupVisible(!1,e.props.mouseLeaveDelay)},e.onFocus=function(t){e.fireEvents("onFocus",t),e.clearDelayTimer(),e.isFocusToShow()&&(e.focusTime=Date.now(),e.delaySetPopupVisible(!0,e.props.focusDelay))},e.onMouseDown=function(t){e.fireEvents("onMouseDown",t),e.preClickTime=Date.now()},e.onTouchStart=function(t){e.fireEvents("onTouchStart",t),e.preTouchTime=Date.now()},e.onBlur=function(t){e.fireEvents("onBlur",t),e.clearDelayTimer(),e.isBlurToHide()&&e.delaySetPopupVisible(!1,e.props.blurDelay)},e.onContextMenu=function(t){t.preventDefault(),e.fireEvents("onContextMenu",t),e.setPopupVisible(!0,t)},e.onContextMenuClose=function(){e.isContextMenuToShow()&&e.close()},e.onClick=function(t){if(e.fireEvents("onClick",t),e.focusTime){var o;if(e.preClickTime&&e.preTouchTime?o=Math.min(e.preClickTime,e.preTouchTime):e.preClickTime?o=e.preClickTime:e.preTouchTime&&(o=e.preTouchTime),Math.abs(o-e.focusTime)<20)return;e.focusTime=0}e.preClickTime=0,e.preTouchTime=0,e.isClickToShow()&&(e.isClickToHide()||e.isBlurToHide())&&t&&t.preventDefault&&t.preventDefault();var a=!e.state.popupVisible;(e.isClickToHide()&&!a||a&&e.isClickToShow())&&e.setPopupVisible(!e.state.popupVisible,t)},e.onPopupMouseDown=function(){if(e.hasPopupMouseDown=!0,clearTimeout(e.mouseDownTimeout),e.mouseDownTimeout=window.setTimeout(function(){e.hasPopupMouseDown=!1},0),e.context){var t;(t=e.context).onPopupMouseDown.apply(t,arguments)}},e.onDocumentClick=function(t){if(!(e.props.mask&&!e.props.maskClosable)){var o=t.target,a=e.getRootDomNode(),d=e.getPopupDomNode();(!q(a,o)||e.isContextMenuOnly())&&!q(d,o)&&!e.hasPopupMouseDown&&e.close()}},e.getRootDomNode=function(){var t=e.props.getTriggerDOMNode;if(t)return t(e.triggerRef.current);try{var o=De(e.triggerRef.current);if(o)return o}catch{}return be.findDOMNode(ye(e))},e.getPopupClassNameFromAlign=function(t){var o=[],a=e.props,d=a.popupPlacement,h=a.builtinPlacements,m=a.prefixCls,u=a.alignPoint,g=a.getPopupClassNameFromAlign;return d&&h&&o.push(Ve(h,m,t,u)),g&&o.push(g(t)),o.join(" ")},e.getComponent=function(){var t=e.props,o=t.prefixCls,a=t.destroyPopupOnHide,d=t.popupClassName,h=t.onPopupAlign,m=t.popupMotion,u=t.popupAnimation,g=t.popupTransitionName,C=t.popupStyle,k=t.mask,M=t.maskAnimation,E=t.maskTransitionName,A=t.maskMotion,V=t.zIndex,S=t.popup,$=t.stretch,_=t.alignPoint,L=t.mobile,z=t.forceRender,B=t.onPopupClick,O=e.state,U=O.popupVisible,W=O.point,j=e.getPopupAlign(),b={};return e.isMouseEnterToShow()&&(b.onMouseEnter=e.onPopupMouseEnter),e.isMouseLeaveToHide()&&(b.onMouseLeave=e.onPopupMouseLeave),b.onMouseDown=e.onPopupMouseDown,b.onTouchStart=e.onPopupMouseDown,r.exports.createElement(fe,N({prefixCls:o,destroyPopupOnHide:a,visible:U,point:_&&W,className:d,align:j,onAlign:h,animation:u,getClassNameFromAlign:e.getPopupClassNameFromAlign},b,{stretch:$,getRootDomNode:e.getRootDomNode,style:C,mask:k,zIndex:V,transitionName:g,maskAnimation:M,maskTransitionName:E,maskMotion:A,ref:e.popupRef,motion:m,mobile:L,forceRender:z,onClick:B}),typeof S=="function"?S():S)},e.attachParent=function(t){D.cancel(e.attachId);var o=e.props,a=o.getPopupContainer,d=o.getDocument,h=e.getRootDomNode(),m;a?(h||a.length===0)&&(m=a(h)):m=d(e.getRootDomNode()).body,m?m.appendChild(t):e.attachId=D(function(){e.attachParent(t)})},e.getContainer=function(){if(!e.portalContainer){var t=e.props.getDocument,o=t(e.getRootDomNode()).createElement("div");o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.width="100%",e.portalContainer=o}return e.attachParent(e.portalContainer),e.portalContainer},e.setPoint=function(t){var o=e.props.alignPoint;!o||!t||e.setState({point:{pageX:t.pageX,pageY:t.pageY}})},e.handlePortalUpdate=function(){e.state.prevPopupVisible!==e.state.popupVisible&&e.props.afterPopupVisibleChange(e.state.popupVisible)},e.triggerContextValue={onPopupMouseDown:e.onPopupMouseDown};var i;return"popupVisible"in s?i=!!s.popupVisible:i=!!s.defaultPopupVisible,e.state={prevPopupVisible:i,popupVisible:i},Be.forEach(function(t){e["fire".concat(t)]=function(o){e.fireEvents(t,o)}}),e}return ke(f,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=this.props,i=this.state;if(i.popupVisible){var t;!this.clickOutsideHandler&&(this.isClickToHide()||this.isContextMenuToShow())&&(t=e.getDocument(this.getRootDomNode()),this.clickOutsideHandler=I(t,"mousedown",this.onDocumentClick)),this.touchOutsideHandler||(t=t||e.getDocument(this.getRootDomNode()),this.touchOutsideHandler=I(t,"touchstart",this.onDocumentClick)),!this.contextMenuOutsideHandler1&&this.isContextMenuToShow()&&(t=t||e.getDocument(this.getRootDomNode()),this.contextMenuOutsideHandler1=I(t,"scroll",this.onContextMenuClose)),!this.contextMenuOutsideHandler2&&this.isContextMenuToShow()&&(this.contextMenuOutsideHandler2=I(window,"blur",this.onContextMenuClose));return}this.clearOutsideHandler()}},{key:"componentWillUnmount",value:function(){this.clearDelayTimer(),this.clearOutsideHandler(),clearTimeout(this.mouseDownTimeout),D.cancel(this.attachId)}},{key:"getPopupDomNode",value:function(){var e;return((e=this.popupRef.current)===null||e===void 0?void 0:e.getElement())||null}},{key:"getPopupAlign",value:function(){var e=this.props,i=e.popupPlacement,t=e.popupAlign,o=e.builtinPlacements;return i&&o?He(o,i,t):t}},{key:"setPopupVisible",value:function(e,i){var t=this.props.alignPoint,o=this.state.popupVisible;this.clearDelayTimer(),o!==e&&("popupVisible"in this.props||this.setState({popupVisible:e,prevPopupVisible:o}),this.props.onPopupVisibleChange(e)),t&&i&&e&&this.setPoint(i)}},{key:"delaySetPopupVisible",value:function(e,i,t){var o=this,a=i*1e3;if(this.clearDelayTimer(),a){var d=t?{pageX:t.pageX,pageY:t.pageY}:null;this.delayTimer=window.setTimeout(function(){o.setPopupVisible(e,d),o.clearDelayTimer()},a)}else this.setPopupVisible(e,t)}},{key:"clearDelayTimer",value:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)}},{key:"clearOutsideHandler",value:function(){this.clickOutsideHandler&&(this.clickOutsideHandler.remove(),this.clickOutsideHandler=null),this.contextMenuOutsideHandler1&&(this.contextMenuOutsideHandler1.remove(),this.contextMenuOutsideHandler1=null),this.contextMenuOutsideHandler2&&(this.contextMenuOutsideHandler2.remove(),this.contextMenuOutsideHandler2=null),this.touchOutsideHandler&&(this.touchOutsideHandler.remove(),this.touchOutsideHandler=null)}},{key:"createTwoChains",value:function(e){var i=this.props.children.props,t=this.props;return i[e]&&t[e]?this["fire".concat(e)]:i[e]||t[e]}},{key:"isClickToShow",value:function(){var e=this.props,i=e.action,t=e.showAction;return i.indexOf("click")!==-1||t.indexOf("click")!==-1}},{key:"isContextMenuOnly",value:function(){var e=this.props.action;return e==="contextMenu"||e.length===1&&e[0]==="contextMenu"}},{key:"isContextMenuToShow",value:function(){var e=this.props,i=e.action,t=e.showAction;return i.indexOf("contextMenu")!==-1||t.indexOf("contextMenu")!==-1}},{key:"isClickToHide",value:function(){var e=this.props,i=e.action,t=e.hideAction;return i.indexOf("click")!==-1||t.indexOf("click")!==-1}},{key:"isMouseEnterToShow",value:function(){var e=this.props,i=e.action,t=e.showAction;return i.indexOf("hover")!==-1||t.indexOf("mouseEnter")!==-1}},{key:"isMouseLeaveToHide",value:function(){var e=this.props,i=e.action,t=e.hideAction;return i.indexOf("hover")!==-1||t.indexOf("mouseLeave")!==-1}},{key:"isFocusToShow",value:function(){var e=this.props,i=e.action,t=e.showAction;return i.indexOf("focus")!==-1||t.indexOf("focus")!==-1}},{key:"isBlurToHide",value:function(){var e=this.props,i=e.action,t=e.hideAction;return i.indexOf("focus")!==-1||t.indexOf("blur")!==-1}},{key:"forcePopupAlign",value:function(){if(this.state.popupVisible){var e;(e=this.popupRef.current)===null||e===void 0||e.forceAlign()}}},{key:"fireEvents",value:function(e,i){var t=this.props.children.props[e];t&&t(i);var o=this.props[e];o&&o(i)}},{key:"close",value:function(){this.setPopupVisible(!1)}},{key:"render",value:function(){var e=this.state.popupVisible,i=this.props,t=i.children,o=i.forceRender,a=i.alignPoint,d=i.className,h=i.autoDestroy,m=r.exports.Children.only(t),u={key:"trigger"};this.isContextMenuToShow()?u.onContextMenu=this.onContextMenu:u.onContextMenu=this.createTwoChains("onContextMenu"),this.isClickToHide()||this.isClickToShow()?(u.onClick=this.onClick,u.onMouseDown=this.onMouseDown,u.onTouchStart=this.onTouchStart):(u.onClick=this.createTwoChains("onClick"),u.onMouseDown=this.createTwoChains("onMouseDown"),u.onTouchStart=this.createTwoChains("onTouchStart")),this.isMouseEnterToShow()?(u.onMouseEnter=this.onMouseEnter,a&&(u.onMouseMove=this.onMouseMove)):u.onMouseEnter=this.createTwoChains("onMouseEnter"),this.isMouseLeaveToHide()?u.onMouseLeave=this.onMouseLeave:u.onMouseLeave=this.createTwoChains("onMouseLeave"),this.isFocusToShow()||this.isBlurToHide()?(u.onFocus=this.onFocus,u.onBlur=this.onBlur):(u.onFocus=this.createTwoChains("onFocus"),u.onBlur=this.createTwoChains("onBlur"));var g=F(m&&m.props&&m.props.className,d);g&&(u.className=g);var C=x({},u);Ne(m)&&(C.ref=Ee(this.triggerRef,m.ref));var k=r.exports.cloneElement(m,C),M;return(e||this.popupRef.current||o)&&(M=r.exports.createElement(n,{key:"portal",getContainer:this.getContainer,didUpdate:this.handlePortalUpdate},this.getComponent())),!e&&h&&(M=null),r.exports.createElement(ue.Provider,{value:this.triggerContextValue},k,M)}}],[{key:"getDerivedStateFromProps",value:function(e,i){var t=e.popupVisible,o={};return t!==void 0&&i.popupVisible!==t&&(o.popupVisible=t,o.prevPopupVisible=i.popupVisible),o}}]),f}(r.exports.Component);return p.contextType=ue,p.defaultProps={prefixCls:"rc-trigger-popup",getPopupClassNameFromAlign:$e,getDocument:ze,onPopupVisibleChange:G,afterPopupVisibleChange:G,onPopupAlign:G,popupClassName:"",mouseEnterDelay:0,mouseLeaveDelay:.1,focusDelay:0,blurDelay:.15,popupStyle:{},destroyPopupOnHide:!1,popupAlign:{},defaultPopupVisible:!1,mask:!1,maskClosable:!0,action:[],showAction:[],hideAction:[],autoDestroy:!1},p}const Je=Ue(Ae);export{Je as T};
