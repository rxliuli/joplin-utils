import{r as i}from"./react.bcb0ff15.js";import{i as p,P as f,n as g,r as y,o as I}from"./index.b69f780e.js";import{v as F}from"./unist-util-visit.23fe510a.js";import{r as R}from"./remark-parse.ae27876c.js";import{r as w}from"./remark-gfm.e6635c2d.js";import{r as b}from"./remark-stringify.8ee5cd32.js";import{u as E}from"./unified.cb173dc7.js";import{A as N,a as S}from"./@liuli-util/async.20364c00.js";import{P as A}from"./PromiseUtil.2bdf064a.js";import{a as C}from"./react-use.f90ee3b0.js";import{C as v,B as x,b as l}from"./antd.829d9a81.js";import"./classnames.fcae7549.js";import"./@liuli-util/react-router.19d629f6.js";import"./history.8c848a87.js";import"./@babel/runtime.77033aed.js";import"./@liuli-util/tree.28f56635.js";import"./react-router.ab39842d.js";import"./@remix-run/router.6675ec4c.js";import"./@liuli-util/i18next-util.367fde1b.js";import"./i18next.aeec162a.js";import"./react-dom.040937d5.js";import"./scheduler.5bc07c2b.js";import"./@liuli-util/object.c3c9f8dd.js";import"./query-string.7a820323.js";import"./strict-uri-encode.82768c6e.js";import"./decode-uri-component.ca13c355.js";import"./split-on-first.cf03b920.js";import"./filter-obj.a2c77fe2.js";import"./@liuli-util/dom.7c7381d8.js";import"./@liuli-util/array.c1e23abd.js";import"./rc-util.9e22709c.js";import"./react-is.e13562bd.js";import"./rc-resize-observer.ce41be3e.js";import"./resize-observer-polyfill.d94677fa.js";import"./rc-motion.4d67ed75.js";import"./@ant-design/icons.9bb0fd12.js";import"./@ant-design/icons-svg.ef1e3299.js";import"./@ant-design/colors.c9ebc826.js";import"./@ctrl/tinycolor.f9239932.js";import"./rc-menu.36873b05.js";import"./shallowequal.9e085e62.js";import"./rc-overflow.1c29c4d3.js";import"./rc-trigger.d92e6a44.js";import"./rc-align.8ac14694.js";import"./dom-align.6f4926e0.js";import"./lodash.9f59e410.js";import"./rc-checkbox.7c78741f.js";import"./rc-tabs.e6ff9661.js";import"./rc-dropdown.ef01eb3e.js";import"./rc-select.5290f568.js";import"./rc-virtual-list.03a0aeaa.js";import"./rc-field-form.bad3530c.js";import"./async-validator.e56392a6.js";import"./scroll-into-view-if-needed.93ce78d3.js";import"./compute-scroll-into-view.9b2bf0c9.js";import"./rc-image.6968645b.js";import"./rc-dialog.1314fb5b.js";import"./rc-pagination.d25a22f9.js";import"./rc-textarea.2a18f0c5.js";import"./copy-to-clipboard.04c46956.js";import"./toggle-selection.ddb32806.js";import"./memoize-one.d2b40972.js";import"./rc-picker.eb87d7c6.js";import"./rc-notification.a2f2b76e.js";import"./rc-tooltip.bb0bf028.js";import"./rc-input.b5c20646.js";import"./tslib.42edd759.js";import"./unist-util-visit-parents.7a4d7581.js";import"./unist-util-is.01e12dde.js";import"./mdast-util-from-markdown.44cf8fe8.js";import"./mdast-util-to-string.fb536fe5.js";import"./micromark.74065510.js";import"./micromark-util-combine-extensions.697f0677.js";import"./micromark-util-chunked.52039b2e.js";import"./micromark-factory-space.8ec3c024.js";import"./micromark-util-character.2c47e118.js";import"./micromark-core-commonmark.3fac04b8.js";import"./micromark-util-classify-character.f47a059b.js";import"./micromark-util-resolve-all.d38fe386.js";import"./decode-named-character-reference.0cf99f69.js";import"./micromark-util-subtokenize.980f7106.js";import"./micromark-factory-destination.f465b346.js";import"./micromark-factory-label.bdfeb2ce.js";import"./micromark-factory-title.f3aaaa31.js";import"./micromark-factory-whitespace.1bcc98ff.js";import"./micromark-util-normalize-identifier.d8c35b62.js";import"./micromark-util-html-tag-name.94b32f7b.js";import"./micromark-util-decode-numeric-character-reference.a2285e6c.js";import"./micromark-util-decode-string.5840a04a.js";import"./unist-util-stringify-position.9bacc487.js";import"./micromark-extension-gfm.03975213.js";import"./micromark-extension-gfm-autolink-literal.422a0654.js";import"./micromark-extension-gfm-footnote.a16b4cca.js";import"./micromark-extension-gfm-strikethrough.a97f0121.js";import"./micromark-extension-gfm-table.a83caa90.js";import"./micromark-extension-gfm-task-list-item.eaae8848.js";import"./mdast-util-gfm.429990b7.js";import"./mdast-util-gfm-autolink-literal.f32082f0.js";import"./ccount.1cb94a01.js";import"./mdast-util-find-and-replace.7ab5ba95.js";import"./escape-string-regexp.cd3f5550.js";import"./mdast-util-gfm-footnote.9f5cbf8c.js";import"./mdast-util-to-markdown.baf38fd2.js";import"./zwitch.ff65d30c.js";import"./longest-streak.7bb4efd1.js";import"./mdast-util-gfm-strikethrough.a9b9f276.js";import"./mdast-util-gfm-task-list-item.40d7ca5a.js";import"./mdast-util-gfm-table.86ff59cf.js";import"./markdown-table.5bc58d43.js";import"./bail.2d65b3d4.js";import"./is-buffer.8f2d14e8.js";import"./extend.9f70b7a3.js";import"./is-plain-obj.5914775f.js";import"./trough.51e639e8.js";import"./vfile.7e51f900.js";import"./vfile-message.84519071.js";const P=E().use(R).use(w).use(b,{bullet:"-",fences:!0,incrementListMarker:!1});function M(m){return m.indexOf("#")!==-1?m.slice(2,m.indexOf("#")):m.slice(2)}function T(m){const s=[];return F(P.parse(m),n=>{var a;if(n.type!=="link"&&n.type!=="image")return;const t=n;!t.url.startsWith(":/")||s.push({id:M(t.url),title:t.type==="link"?(a=t.title)!=null?a:t.children[0].value:t.alt})}),s}class _{constructor(){}check(){return A.warpOnEvent(async s=>{s.load(p.t("notFoundResource.loadResources"));const n=new Set((await this.getAllResourceIdList()).map(r=>r.id));s.load(p.t("notFoundResource.loadNotes"));const t=await f.pageToAllList(g.list.bind(g),{fields:["id","title","body","user_updated_time"]}),a=t.reduce((r,c)=>r.add(c.id),new Set);s.load(p.t("notFoundResource.parseNotes"));let d=0;const o=[],L=(await N.map(t,S(async r=>{var k;const c=T(r.body);o.push(...c.map(u=>u.id));const h=c.filter(u=>!n.has(u.id)&&!a.has(u.id));return d++,s.parse({rate:d,all:t.length,title:(k=r.title)!=null?k:p.t("notFoundResource.unknownFileName",{id:r.id})}),{...r,errorLinks:h}},10))).filter(r=>r.errorLinks.length!==0);return console.log("debug data: ",{resourceIdList:[...n],noteIdList:[...a],allLinks:o,resolvedNoteList:L.map(r=>({id:r.id,errorLinks:r.errorLinks.map(c=>c.id)}))}),L})}async getAllResourceIdList(){return await f.pageToAllList(y.list.bind(y),{fields:["id","title","mime"]})}}const O="_subList_1op68_1",$={subList:O},B=new _,Hr=()=>{const[m,s]=i.exports.useState([]),[n,t]=i.exports.useState(""),[a,d]=C(async()=>{const o=await B.check().on("load",e=>t(e)).on("parse",e=>{t(`[${e.rate}/${e.all}] ${e.title}`)});console.log("list: ",o),s(o)});return i.exports.createElement(v,{title:p.t("notFoundResource.title"),extra:i.exports.createElement(x,{onClick:d},p.t("common.action.check"))},i.exports.createElement(l,{dataSource:m,locale:{emptyText:p.t("notFoundResource.listEmptyText")},renderItem:o=>i.exports.createElement(l.Item,{key:"note-"+o.id,actions:[i.exports.createElement(x,{onClick:()=>I(o.id)},p.t("common.action.open"))]},i.exports.createElement(l.Item.Meta,{title:o.title,description:i.exports.createElement(l,{className:$.subList,dataSource:o.errorLinks,renderItem:e=>i.exports.createElement(l.Item,{key:"resource-"+o.id+"-"+e.id},i.exports.createElement(l.Item.Meta,{title:e.title||p.t("notFoundResource.unknownFileName",e)}))})})),loading:{spinning:a.loading,tip:n}}))};export{Hr as default};
