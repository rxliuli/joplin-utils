function x(){const f=[],s={run:c,use:h};return s;function c(...n){let u=-1;const t=n.pop();if(typeof t!="function")throw new TypeError("Expected function as last argument, not "+t);i(null,...n);function i(e,...o){const r=f[++u];let l=-1;if(e){t(e);return}for(;++l<n.length;)(o[l]===null||o[l]===void 0)&&(o[l]=n[l]);n=o,r?p(r,i)(...o):t(null,...o)}}function h(n){if(typeof n!="function")throw new TypeError("Expected `middelware` to be a function, not "+n);return f.push(n),s}}function p(f,s){let c;return h;function h(...t){const i=f.length>t.length;let e;i&&t.push(n);try{e=f.apply(this,t)}catch(o){const r=o;if(i&&c)throw r;return n(r)}i||(e instanceof Promise?e.then(u,n):e instanceof Error?n(e):u(e))}function n(t,...i){c||(c=!0,s(t,...i))}function u(t){n(null,t)}}export{x as t};
