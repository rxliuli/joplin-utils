import{c as f,a as oe,d as L,_ as Xe,b as Ee,e as he}from"./@babel/runtime.77033aed.js";import{r}from"./react.bcb0ff15.js";import{c as te}from"./classnames.fcae7549.js";import{e as We,v as Be,b as Ze,K as Fe,k as ue,x as Je}from"./rc-util.9e22709c.js";import{D as Qe}from"./rc-dialog.1314fb5b.js";function er(u){var e=r.exports.useRef(null),l=r.exports.useState(u),n=f(l,2),g=n[0],v=n[1],p=r.exports.useRef([]),i=function(w){e.current===null&&(p.current=[],e.current=We(function(){v(function(S){var d=S;return p.current.forEach(function($){d=oe(oe({},d),$)}),e.current=null,d})})),p.current.push(w)};return r.exports.useEffect(function(){return function(){return e.current&&We.cancel(e.current)}},[]),[g,i]}function Ye(u,e,l,n){var g=e+l,v=(l-n)/2;if(l>n){if(e>0)return L({},u,v);if(e<0&&g<n)return L({},u,-v)}else if(e<0||g>n)return L({},u,e<0?v:-v);return{}}function rr(u,e,l,n){var g=Be(),v=g.width,p=g.height,i=null;return u<=v&&e<=p?i={x:0,y:0}:(u>v||e>p)&&(i=oe(oe({},Ye("x",l,u,v)),Ye("y",n,e,p))),i}var tr=["visible","onVisibleChange","getContainer","current","countRender"],Ue=r.exports.createContext({previewUrls:new Map,setPreviewUrls:function(){return null},current:null,setCurrent:function(){return null},setShowPreview:function(){return null},setMousePosition:function(){return null},registerImage:function(){return function(){return null}},rootClassName:""}),or=Ue.Provider,nr=function(e){var l=e.previewPrefixCls,n=l===void 0?"rc-image-preview":l,g=e.children,v=e.icons,p=v===void 0?{}:v,i=e.preview,x=Xe(i)==="object"?i:{},w=x.visible,S=w===void 0?void 0:w,d=x.onVisibleChange,$=d===void 0?void 0:d,U=x.getContainer,ve=U===void 0?void 0:U,V=x.current,W=V===void 0?0:V,ne=x.countRender,F=ne===void 0?void 0:ne,ie=Ee(x,tr),fe=r.exports.useState(new Map),Y=f(fe,2),h=Y[0],E=Y[1],pe=r.exports.useState(),A=f(pe,2),K=A[0],_=A[1],de=Ze(!!S,{value:S,onChange:$}),T=f(de,2),m=T[0],b=T[1],I=r.exports.useState(null),c=f(I,2),X=c[0],z=c[1],M=S!==void 0,Z=Array.from(h.keys()),R=Z[W],D=new Map(Array.from(h).filter(function(P){var s=f(P,2),C=s[1].canPreview;return!!C}).map(function(P){var s=f(P,2),C=s[0],a=s[1].url;return[C,a]})),ae=function(s,C){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,se=function(){E(function(H){var G=new Map(H),q=G.delete(s);return q?G:H})};return E(function(k){return new Map(k).set(s,{url:C,canPreview:a})}),se},j=function(s){s.stopPropagation(),b(!1),z(null)};return r.exports.useEffect(function(){_(R)},[R]),r.exports.useEffect(function(){!m&&M&&_(R)},[R,M,m]),r.exports.createElement(or,{value:{isPreviewGroup:!0,previewUrls:D,setPreviewUrls:E,current:K,setCurrent:_,setShowPreview:b,setMousePosition:z,registerImage:ae}},g,r.exports.createElement(je,he({"aria-hidden":!m,visible:m,prefixCls:n,onClose:j,mousePosition:X,src:D.get(K),icons:p,getContainer:ve,countRender:F},ie)))},ir=["prefixCls","src","alt","onClose","afterClose","visible","icons","rootClassName","countRender"],Ne=r.exports.useState,Ae=r.exports.useEffect,ar=r.exports.useCallback,Ke=r.exports.useRef,sr=r.exports.useContext,re={x:0,y:0},je=function(e){var l,n=e.prefixCls,g=e.src,v=e.alt,p=e.onClose;e.afterClose;var i=e.visible,x=e.icons,w=x===void 0?{}:x,S=e.rootClassName,d=e.countRender,$=Ee(e,ir),U=w.rotateLeft,ve=w.rotateRight,V=w.zoomIn,W=w.zoomOut,ne=w.close,F=w.left,ie=w.right,fe=Ne(1),Y=f(fe,2),h=Y[0],E=Y[1],pe=Ne(0),A=f(pe,2),K=A[0],_=A[1],de=er(re),T=f(de,2),m=T[0],b=T[1],I=Ke(),c=Ke({originX:0,originY:0,deltaX:0,deltaY:0}),X=Ne(!1),z=f(X,2),M=z[0],Z=z[1],R=sr(Ue),D=R.previewUrls,ae=R.current,j=R.isPreviewGroup,P=R.setCurrent,s=D.size,C=Array.from(D.keys()),a=C.indexOf(ae),se=j?D.get(ae):g,k=j&&s>1,H=Ne({wheelDirection:0}),G=f(H,2),q=G[0],ke=G[1],Pe=function(){E(1),_(0),b(re)},le=function(){E(function(t){return t+1}),b(re)},B=function(){h>1&&E(function(t){return t-1}),b(re)},_e=function(){_(function(t){return t+90})},Se=function(){_(function(t){return t-90})},Ie=function(t){t.preventDefault(),t.stopPropagation(),a>0&&P(C[a-1])},ye=function(t){t.preventDefault(),t.stopPropagation(),a<s-1&&P(C[a+1])},J=te(L({},"".concat(n,"-moving"),M)),Q="".concat(n,"-operations-operation"),me="".concat(n,"-operations-icon"),De=[{icon:ne,onClick:p,type:"close"},{icon:V,onClick:le,type:"zoomIn"},{icon:W,onClick:B,type:"zoomOut",disabled:h===1},{icon:ve,onClick:_e,type:"rotateRight"},{icon:U,onClick:Se,type:"rotateLeft"}],be=function(){if(i&&M){var t=I.current.offsetWidth*h,N=I.current.offsetHeight*h,O=I.current.getBoundingClientRect(),ee=O.left,Ce=O.top,xe=K%180!==0;Z(!1);var Re=rr(xe?N:t,xe?t:N,ee,Ce);Re&&b(oe({},Re))}},Le=function(t){t.button===0&&(t.preventDefault(),t.stopPropagation(),c.current.deltaX=t.pageX-m.x,c.current.deltaY=t.pageY-m.y,c.current.originX=m.x,c.current.originY=m.y,Z(!0))},ge=function(t){i&&M&&b({x:t.pageX-c.current.deltaX,y:t.pageY-c.current.deltaY})},$e=function(t){if(!!i){t.preventDefault();var N=t.deltaY;ke({wheelDirection:N})}},Me=ar(function(o){!i||!k||(o.preventDefault(),o.keyCode===Fe.LEFT?a>0&&P(C[a-1]):o.keyCode===Fe.RIGHT&&a<s-1&&P(C[a+1]))},[a,s,C,P,k,i]),we=function(){i&&(h!==1&&E(1),(m.x!==re.x||m.y!==re.y)&&b(re))};return Ae(function(){var o=q.wheelDirection;o>0?B():o<0&&le()},[q]),Ae(function(){var o,t,N=ue(window,"mouseup",be,!1),O=ue(window,"mousemove",ge,!1),ee=ue(window,"wheel",$e,{passive:!1}),Ce=ue(window,"keydown",Me,!1);try{window.top!==window.self&&(o=ue(window.top,"mouseup",be,!1),t=ue(window.top,"mousemove",ge,!1))}catch{}return function(){N.remove(),O.remove(),ee.remove(),Ce.remove(),o&&o.remove(),t&&t.remove()}},[i,M,Me]),r.exports.createElement(Qe,he({transitionName:"zoom",maskTransitionName:"fade",closable:!1,keyboard:!0,prefixCls:n,onClose:p,afterClose:Pe,visible:i,wrapClassName:J,rootClassName:S},$),r.exports.createElement("ul",{className:"".concat(n,"-operations")},k&&r.exports.createElement("li",{className:"".concat(n,"-operations-progress")},(l=d==null?void 0:d(a+1,s))!==null&&l!==void 0?l:"".concat(a+1," / ").concat(s)),De.map(function(o){var t=o.icon,N=o.onClick,O=o.type,ee=o.disabled;return r.exports.createElement("li",{className:te(Q,L({},"".concat(n,"-operations-operation-disabled"),!!ee)),onClick:N,key:O},r.exports.isValidElement(t)?r.exports.cloneElement(t,{className:me}):t)})),r.exports.createElement("div",{className:"".concat(n,"-img-wrapper"),style:{transform:"translate3d(".concat(m.x,"px, ").concat(m.y,"px, 0)")}},r.exports.createElement("img",{width:e.width,height:e.height,onMouseDown:Le,onDoubleClick:we,ref:I,className:"".concat(n,"-img"),src:se,alt:v,style:{transform:"scale3d(".concat(h,", ").concat(h,", 1) rotate(").concat(K,"deg)")}})),k&&r.exports.createElement("div",{className:te("".concat(n,"-switch-left"),L({},"".concat(n,"-switch-left-disabled"),a===0)),onClick:Ie},F),k&&r.exports.createElement("div",{className:te("".concat(n,"-switch-right"),L({},"".concat(n,"-switch-right-disabled"),a===s-1)),onClick:ye},ie))},lr=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName","crossOrigin","decoding","loading","referrerPolicy","sizes","srcSet","useMap","draggable"],cr=["src","visible","onVisibleChange","getContainer","mask","maskClassName","icons"],Te=0,He=function(e){var l,n=e.src,g=e.alt,v=e.onPreviewClose,p=e.prefixCls,i=p===void 0?"rc-image":p,x=e.previewPrefixCls,w=x===void 0?"".concat(i,"-preview"):x,S=e.placeholder,d=e.fallback,$=e.width,U=e.height,ve=e.style,V=e.preview,W=V===void 0?!0:V,ne=e.className,F=e.onClick,ie=e.onError,fe=e.wrapperClassName,Y=e.wrapperStyle,h=e.rootClassName,E=e.crossOrigin,pe=e.decoding,A=e.loading,K=e.referrerPolicy,_=e.sizes,de=e.srcSet,T=e.useMap,m=e.draggable,b=Ee(e,lr),I=S&&S!==!0,c=Xe(W)==="object"?W:{},X=c.src,z=c.visible,M=z===void 0?void 0:z,Z=c.onVisibleChange,R=Z===void 0?v:Z,D=c.getContainer,ae=D===void 0?void 0:D,j=c.mask,P=c.maskClassName,s=c.icons,C=Ee(c,cr),a=X!=null?X:n,se=M!==void 0,k=Ze(!!M,{value:M,onChange:R}),H=f(k,2),G=H[0],q=H[1],ke=r.exports.useState(I?"loading":"normal"),Pe=f(ke,2),le=Pe[0],B=Pe[1],_e=r.exports.useState(null),Se=f(_e,2),Ie=Se[0],ye=Se[1],J=le==="error",Q=r.exports.useContext(Ue),me=Q.isPreviewGroup,De=Q.setCurrent,be=Q.setShowPreview,Le=Q.setMousePosition,ge=Q.registerImage,$e=r.exports.useState(function(){return Te+=1,Te}),Me=f($e,1),we=Me[0],o=W&&!J,t=r.exports.useRef(!1),N=function(){B("normal")},O=function(y){ie&&ie(y),B("error")},ee=function(y){if(!se){var Ge=Je(y.target),Oe=Ge.left,Ve=Ge.top;me?(De(we),Le({x:Oe,y:Ve})):ye({x:Oe,y:Ve})}me?be(!0):q(!0),F&&F(y)},Ce=function(y){y.stopPropagation(),q(!1),se||ye(null)},xe=function(y){t.current=!1,le==="loading"&&(y==null?void 0:y.complete)&&(y.naturalWidth||y.naturalHeight)&&(t.current=!0,N())};r.exports.useEffect(function(){var ce=ge(we,a);return ce},[]),r.exports.useEffect(function(){ge(we,a,o)},[a,o]),r.exports.useEffect(function(){J&&B("normal"),I&&!t.current&&B("loading")},[n]);var Re=te(i,fe,h,L({},"".concat(i,"-error"),J)),qe=J&&d?d:a,ze={crossOrigin:E,decoding:pe,draggable:m,loading:A,referrerPolicy:K,sizes:_,srcSet:de,useMap:T,alt:g,className:te("".concat(i,"-img"),L({},"".concat(i,"-img-placeholder"),S===!0),ne),style:oe({height:U},ve)};return r.exports.createElement(r.exports.Fragment,null,r.exports.createElement("div",he({},b,{className:Re,onClick:o?ee:F,style:oe({width:$,height:U},Y)}),r.exports.createElement("img",he({},ze,{ref:xe},J&&d?{src:d}:{onLoad:N,onError:O,src:n},{width:$,height:U})),le==="loading"&&r.exports.createElement("div",{"aria-hidden":"true",className:"".concat(i,"-placeholder")},S),j&&o&&r.exports.createElement("div",{className:te("".concat(i,"-mask"),P),style:{display:((l=ze.style)===null||l===void 0?void 0:l.display)==="none"?"none":void 0}},j)),!me&&o&&r.exports.createElement(je,he({"aria-hidden":!G,visible:G,prefixCls:w,onClose:Ce,mousePosition:Ie,src:qe,alt:g,getContainer:ae,icons:s,rootClassName:h},C)))};He.PreviewGroup=nr;He.displayName="Image";export{He as I};
